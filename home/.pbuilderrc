#!/bin/bash

set -x

BASEDIRECTORY="/srv/pbuilder/cache"

DIST=${DIST:-debian}
CODENAME=${CODENAME:-sid}
ARCH=${ARCH:-amd64}
COMPONENT="${COMPONENT:-nightly}"

# pbuilder options
BASETGZ="$BASEDIRECTORY/base-$DIST-$CODENAME-$ARCH.tgz"
DISTRIBUTION="$CODENAME"
BUILDRESULT="$BASEDIRECTORY/$DIST-$CODENAME-$ARCH/result/"
APTCACHE="$BASEDIRECTORY/$DIST-$CODENAME-$ARCH/aptcache/"

BUILDRESULTUID=$(id -u)
BUILDRESULTGID=$(id -g)

# this needs to be disabled
CCACHEDIR=
APTCACHEHARDLINK="yes"
USE_DEBUILD_INTERNAL="yes"
PRESERVE_BUILDPLACE="yes"

ARCHITECTURE="$ARCH"

# pbuilder-uml option
UML_DISTRIBUTION="$CODENAME"

# qemubuilder options
BASEPATH="$BASEDIRECTORY/base-$DIST-$CODENAME-$ARCH.qemu"
if [ -e "/srv/pbuilder/qemu-kernels/$ARCH/vmlinuz.$CODENAME" ]; then
	KERNEL_IMAGE=/srv/pbuilder/qemu-kernels/$ARCH/vmlinuz.$CODENAME
else
	KERNEL_IMAGE=/srv/pbuilder/qemu-kernels/$ARCH/vmlinuz
fi

ARCH_DISKDEVICE=sd
if [ "x$ARCH" = "xarmel" ]; then
	MEMORY_MEGS=256
	INITRD=
else
	SMP="2"
	MEMORY_MEGS=512
	INITRD=/srv/pbuilder/qemu-kernels/$ARCH/initrd.img
fi

if [ "x${DIST}" = "xubuntu" ]; then 
	if [ "x$ARCH" = "xarmel" ] || [ "x$ARCH" = "xpowerpc" ]; then
		MIRRORSITE="http://localhost:3142/ports.ubuntu.com/"
	else
	        MIRRORSITE="http://localhost:3142/ubuntu"
	fi
elif [ "x${DIST}" = "xdebian" ]; then
	if [ "x${CODENAME}" = "xlenny" ]; then
		MIRRORSITE="http://localhost:3142/archive.debian.org/debian"
	else
	        MIRRORSITE="http://localhost:3142/debian"
	fi
fi

EXTRA_ARCHS=armel

#!/bin/bash

set -e

for pkg in "$@"; do
	ssh -lnwt code.das-netzwerkteam.de "cd /srv/git/code.das-netzwerkteam.de && ./setup-repository $pkg '$pkg upstream project'"
	ssh -lnwt code.das-netzwerkteam.de "cd /srv/git/code.das-netzwerkteam.de && ./update-repository-posixacls $pkg"
	cd "$pkg"
	echo "$pkg: MASTER BRANCH" && git push ssh://nwt@code.das-netzwerkteam.de:32032/srv/git/code.das-netzwerkteam.de/$pkg master 
	git branch | grep upstream &>/dev/null && echo "$pkg: RELEASE BRANCH" && git push ssh://nwt@code.das-netzwerkteam.de:32032/srv/git/code.das-netzwerkteam.de/$pkg upstream
	git branch | grep pristine-tar &>/dev/null && echo "$pkg: PRISTINE-TAR" && git push ssh://nwt@code.das-netzwerkteam.de:32032/srv/git/code.das-netzwerkteam.de/$pkg pristine-tar
	echo "$pkg: PUSHING TAGS" && git push --tags ssh://nwt@code.das-netzwerkteam.de:32032/srv/git/code.das-netzwerkteam.de/$pkg
	ssh -lnwt code.das-netzwerkteam.de "cd /srv/git/code.das-netzwerkteam.de && mv $pkg.git itzks"
	cd ..
done
